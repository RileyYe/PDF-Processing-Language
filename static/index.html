<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Processing Language</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon.svg">
    <meta name="theme-color" content="#1e293b">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ms-blue': '#60a5fa',
                        'ms-blue-dark': '#3b82f6',
                        'ms-blue-light': 'rgba(96, 165, 250, 0.1)',
                        'ms-dark': {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            850: '#0f172a',
                            900: '#0c1220',
                            950: '#020617'
                        }
                    },
                    fontFamily: {
                        'ms': ['Segoe UI', 'system-ui', '-apple-system', 'sans-serif']
                    },
                    boxShadow: {
                        'ms-dark': '0 1.6px 3.6px rgba(0, 0, 0, 0.4), 0 0.3px 0.9px rgba(0, 0, 0, 0.3)',
                        'ms-hover-dark': '0 6.4px 14.4px rgba(0, 0, 0, 0.5), 0 1.2px 3.6px rgba(0, 0, 0, 0.4)',
                        'ms-glow': '0 0 20px rgba(96, 165, 250, 0.3)'
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
</head>
<body class="font-ms bg-ms-dark-950 min-h-screen">
    <!-- Main Container -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Syntax Help -->
        <div class="mb-8">
            <div class="flex items-center mb-6 cursor-pointer select-none" id="syntaxHelpToggle">
                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center mr-3 shadow-ms-glow">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-white flex-1">语法帮助</h2>
                <div class="ml-3 transform transition-transform duration-200" id="syntaxHelpChevron">
                    <svg class="w-5 h-5 text-ms-dark-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>
            
            <div id="syntaxHelpContent" class="bg-ms-dark-800 rounded-lg p-6 border border-ms-dark-700 shadow-ms-dark hidden transition-all duration-300 ease-in-out">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 基本语法 -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <div class="w-5 h-5 bg-ms-blue rounded mr-2"></div>
                            基本语法
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-ms-blue font-mono mb-1">操作符{参数:值} | 下一个操作符</p>
                                <p class="text-ms-dark-300">管道操作符 <span class="text-white font-mono">|</span> 连接多个处理步骤</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-ms-blue font-mono mb-1">Load{url:"文件路径"}</p>
                                <p class="text-ms-dark-300">加载PDF文件，支持本地路径和URL</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-ms-blue font-mono mb-1">Save{name:"输出名称"}</p>
                                <p class="text-ms-dark-300">保存处理结果到指定文件</p>
                            </div>
                        </div>
                    </div>

                    <!-- 选择操作 -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <div class="w-5 h-5 bg-green-500 rounded mr-2"></div>
                            页面选择
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-green-400 font-mono mb-1">Select{pages:"1..5"}</p>
                                <p class="text-ms-dark-300">选择页面范围（第1到5页）</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-green-400 font-mono mb-1">Select{pages:"1 3 5"}</p>
                                <p class="text-ms-dark-300">选择特定页面（第1、3、5页）</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-green-400 font-mono mb-1">Select{where:"$page % 2 == 1"}</p>
                                <p class="text-ms-dark-300">条件选择（奇数页）</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-green-400 font-mono mb-1">Select{mode:"each"}</p>
                                <p class="text-ms-dark-300">选择每一页，等价于Select{pages:"1..$total"}，也等价于 Select{where: "$page > 0"}</p>
                            </div>
                        </div>
                    </div>

                    <!-- 转换操作 -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <div class="w-5 h-5 bg-yellow-500 rounded mr-2"></div>
                            格式转换
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-yellow-400 font-mono mb-1">PNG{dpi:300}</p>
                                <p class="text-ms-dark-300">转换为PNG图片，指定DPI</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-yellow-400 font-mono mb-1">PNG{dpi:300, mode: "single"}</p>
                                <p class="text-ms-dark-300">指定DPI，合并为单个图片</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-yellow-400 font-mono mb-1">Concat</p>
                                <p class="text-ms-dark-300">合并多个页面为单个文件</p>
                            </div>
                        </div>
                    </div>

                    <!-- 变量和函数 -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <div class="w-5 h-5 bg-red-500 rounded mr-2"></div>
                            变量和函数
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-red-400 font-mono mb-1">$page</p>
                                <p class="text-ms-dark-300">当前页码（从1开始）</p>
                            </div>
                            <div class="bg-ms-dark-700 rounded-md p-3 border border-ms-dark-600">
                                <p class="text-red-400 font-mono mb-1">$total</p>
                                <p class="text-ms-dark-300">总页数</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 完整示例 -->
                <div class="mt-6 pt-6 border-t border-ms-dark-600">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <div class="w-5 h-5 bg-purple-500 rounded mr-2"></div>
                        完整示例
                    </h3>
                    <div class="bg-ms-dark-900 rounded-lg p-4 border border-ms-dark-600">
                        <div class="font-mono text-sm text-ms-blue leading-relaxed">
                            <div>Load{url:"document.pdf"}</div>
                            <div class="text-ms-dark-400">  | Select{where:"$page > 2 && $page < $total - 1"}</div>
                            <div class="text-ms-dark-400">  | Concat</div>
                            <div class="text-ms-dark-400">  | PNG{dpi:300}</div>
                            <div class="text-ms-dark-400">  | Save{name:"我的图片"}</div>
                        </div>
                        <p class="text-ms-dark-300 text-sm mt-3">
                            加载PDF → 选择中间页面（排除前2页和最后1页）→ 合并 → 转换为高分辨率PNG → 保存并命名为“我的图片”
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Usage Examples -->
        <div class="mb-8">
            <div class="flex items-center mb-6">
                <div class="w-8 h-8 bg-ms-blue rounded-lg flex items-center justify-center mr-3 shadow-ms-glow">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-white">快速开始</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- PDF转图片 -->
                <div class="usage-card bg-ms-dark-800 rounded-lg p-4 border border-ms-dark-700 hover:border-ms-blue cursor-pointer hover:shadow-ms-glow" 
                     data-example='Load{url:"https://example.com/document.pdf"} | Select{mode:"each"} | PNG{dpi:300} | Save{name:"pages"}'>
                    <div class="flex items-center mb-3">
                        <div class="w-6 h-6 bg-blue-500 rounded-md flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-white font-medium">PDF转图片</h3>
                    </div>
                    <p class="text-ms-dark-300 text-sm">将PDF的每一页都转换为PNG图片</p>
                </div>

                <!-- 提取奇数页 -->
                <div class="usage-card bg-ms-dark-800 rounded-lg p-4 border border-ms-dark-700 hover:border-ms-blue cursor-pointer hover:shadow-ms-glow"
                     data-example='Load{url:"https://example.com/document.pdf"} | Select{where:"$page % 2 == 1"} | Concat | Save{name:"odd_pages"}'>
                    <div class="flex items-center mb-3">
                        <div class="w-6 h-6 bg-green-500 rounded-md flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                        <h3 class="text-white font-medium">提取奇数页</h3>
                    </div>
                    <p class="text-ms-dark-300 text-sm">提取所有奇数页并合并为新PDF</p>
                </div>

                <!-- 指定页面范围 -->
                <div class="usage-card bg-ms-dark-800 rounded-lg p-4 border border-ms-dark-700 hover:border-ms-blue cursor-pointer hover:shadow-ms-glow"
                     data-example='Load{url:"https://example.com/document.pdf"} | Select{pages:"1..5 10 15..20"} | Save{name:"selected_pages"}'>
                    <div class="flex items-center mb-3">
                        <div class="w-6 h-6 bg-yellow-500 rounded-md flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                        </div>
                        <h3 class="text-white font-medium">指定页面范围</h3>
                    </div>
                    <p class="text-ms-dark-300 text-sm">提取指定的页面范围和页码</p>
                </div>

                <!-- 封面封底 -->
                <div class="usage-card bg-ms-dark-800 rounded-lg p-4 border border-ms-dark-700 hover:border-ms-blue cursor-pointer hover:shadow-ms-glow"
                     data-example='Load{url:"https://example.com/document.pdf"} | Select{pages:"1 $total"} | Save{name:"cover_back"}'>
                    <div class="flex items-center mb-3">
                        <div class="w-6 h-6 bg-purple-500 rounded-md flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        </div>
                        <h3 class="text-white font-medium">封面封底</h3>
                    </div>
                    <p class="text-ms-dark-300 text-sm">只提取首页和最后一页</p>
                </div>

                <!-- 高分辨率转换 -->
                <div class="usage-card bg-ms-dark-800 rounded-lg p-4 border border-ms-dark-700 hover:border-ms-blue cursor-pointer hover:shadow-ms-glow"
                     data-example='Load{url:"https://example.com/document.pdf"} | PNG{dpi:600} | Save{name:"high_res_image"}'>
                    <div class="flex items-center mb-3">
                        <div class="w-6 h-6 bg-red-500 rounded-md flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </div>
                        <h3 class="text-white font-medium">高分辨率合并图</h3>
                    </div>
                    <p class="text-ms-dark-300 text-sm">转换为高分辨率单张合并图片</p>
                </div>

                <!-- 按条件筛选 -->
                <div class="usage-card bg-ms-dark-800 rounded-lg p-4 border border-ms-dark-700 hover:border-ms-blue cursor-pointer hover:shadow-ms-glow"
                     data-example='Load{url:"https://example.com/document.pdf"} | Select{where:"$page > 5 && $page < $total - 2"} | Concat | Save{name:"middle_pages"}'>
                    <div class="flex items-center mb-3">
                        <div class="w-6 h-6 bg-indigo-500 rounded-md flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                            </svg>
                        </div>
                        <h3 class="text-white font-medium">条件筛选</h3>
                    </div>
                    <p class="text-ms-dark-300 text-sm">按复杂条件筛选中间页面</p>
                </div>
            </div>
        </div>

        <!-- Editor Section -->
        <div class="bg-ms-dark-800 rounded-lg shadow-ms-dark overflow-hidden border border-ms-dark-700">
            <!-- Editor Header -->
            <div class="bg-ms-dark-850 border-b border-ms-dark-700 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-ms-blue rounded-full mr-3 shadow-ms-glow"></div>
                        <h2 class="text-lg font-semibold text-white">管道编辑器</h2>
                    </div>
                    <div class="flex space-x-3">
                        <button id="clearBtn" class="px-4 py-2 h-11 text-sm font-medium text-ms-dark-300 bg-ms-dark-700 border border-ms-dark-600 rounded-md hover:bg-ms-dark-600 hover:border-ms-dark-500 hover:text-white focus:outline-none focus:ring-2 focus:ring-ms-blue focus:ring-offset-2 focus:ring-offset-ms-dark-800 transition-all duration-200">
                            清空
                        </button>
                        <button id="executeBtn" class="px-6 py-2 h-11 text-sm font-medium text-white bg-ms-blue border border-transparent rounded-md hover:bg-ms-blue-dark hover:shadow-ms-glow focus:outline-none focus:ring-2 focus:ring-ms-blue focus:ring-offset-2 focus:ring-offset-ms-dark-800 transition-all duration-200">
                            执行管道
                        </button>
                    </div>
                </div>
            </div>
            <!-- Editor Container -->
            <div id="editor" class="w-full h-64"></div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity bg-black bg-opacity-70" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-ms-dark-800 rounded-lg shadow-xl border border-ms-dark-700 transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-ms-dark-800 rounded-lg">
                    <div class="flex items-center justify-between p-6 border-b border-ms-dark-700">
                        <h3 class="text-lg font-semibold text-white">执行结果</h3>
                        <button id="closeModal" class="text-ms-dark-400 hover:text-ms-dark-200 hover:bg-ms-dark-700 rounded-md p-2 transition-colors duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 max-h-80 overflow-y-auto">
                        <div id="resultMessage" class="text-sm text-ms-dark-200 leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-50 bg-ms-dark-950 bg-opacity-90 flex items-center justify-center hidden">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-ms-blue mx-auto mb-4"></div>
            <p class="text-white font-medium">正在执行管道...</p>
        </div>
    </div>

    <!-- Custom Styles for Monaco Editor -->
    <style>

        /* Custom scrollbar */
        .overflow-y-auto::-webkit-scrollbar {
            width: 6px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Glow effect for active elements */
        .shadow-ms-glow {
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
        }
        /* Usage card styles */
        .usage-card {
            transition: all 0.2s ease-in-out;
        }
        .usage-card:hover {
            background-color: #152238 !important; /* bg-ms-dark-750 */
            transform: translateY(-2px);
        }
        .usage-card:active {
            transform: translateY(0px) scale(0.98);
        }
    </style>

    <script src="/static/script.js"></script>
</body>
</html> 